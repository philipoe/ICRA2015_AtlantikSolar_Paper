%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{DETAILED DESIGN AND REALIZATION}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

AtlantikSolar (Fig. \ref{fig:AtlantikSolarCollage}) is a solar-powered Low-Altitude Long-Endurance(LALE) UAV designed and built at ETH Zurich for perpetual flight at $\varphi=45°$ geographical latitude from April 21\textsuperscript{st} to August 21\textsuperscript{st}. Although its design is mostly dictated by the requirement for low level-flight power consumption, it provides means to mount an advanced optical\&infrared sensor pod developed at ETH Zurich for use in autonomous search and rescue or industrial inspection missions. The airplane airframe characteristics are summarized in table \ref{tab:DetailedDesignParameters}. An overview over the airplane system topology is given in Fig. \ref{fig:AtlantikSolar_SystemOverview}.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/10_CAD_AtlantikSolarAvionics_Combined}
    \caption{Left: Wing structure with integrated batteries and solar cells. Right: Main avionics layout inside the airplane.}
    \label{fig:CAD_AtlantikSolarStructureAndAvionics}
\end{figure}
%\begin{figure}[tb]
%    \centering
%    \includegraphics[width=\linewidth]{images/6_CAD_AtlantikSolarFull}
%    \caption{The AtlantikSolar UAV features a conventional T-tail configuration with 1 motor, two ailerons, an all-moving elevator and a rudder for actuation.}
%    \label{fig:CAD_AtlantikSolarFull}
%\end{figure}

\begin{table}
\caption{AtlantikSolar design characteristics}
\label{tab:DetailedDesignParameters}
\begin{center}
\begin{tabular}{l l}
Wing span & 5.65$\unit{m}$\\
\hline Wing chord& 0.305$\unit{m}$\\
\hline Length& 2.03\unit{m}\\
\hline Height&0.45\unit{m}\\
\hline Mass& 7.36$\unit{kg}$\\
\hline Battery mass& 3.52$\unit{kg}$\\
\hline Wing loading&4.28$\unitfrac{kg}{m^2}$\\
\hline Stall speed& 8.1$\unitfrac{m}{s}$\\
\end{tabular}
\end{center}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{UAV Platform Design}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Airframe}\label{secsec:Airframe and hardware}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The structure of AtlantikSolar is built in a traditional rib-spar construction method (Fig. \ref{fig:CAD_AtlantikSolarStructureAndAvionics}). The wing's main element is an inner cylindrical carbon-fibre spar to resist torsional wing loads. Four carbon-fibre belts of trapezoidal and laterally-varying cross-section are attached to the spar to optimally resist bending loads and to provide maximum wing stiffness to structurally unload the wing surface and especially the solar cells. The main wing can be disassembled into three wing pieces of $b<2m$ each. The horizontal and vertical stabilizers are built as the main wing.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Energy Generation and Storage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The cylindrical wing spars are fitted with 72 cylindrical high energy-density industrial Lithium-Ion battery cells (Panasonic NCR18650b, 243Wh/kg) to optimally distribute the battery mass in a ``span loader'' concept. The cells are connected in a 6S (22.2V) configuration and provide $E_{bat,max}=850Wh$ at $m_{bat}=3.5kg$. The solar modules feature a total of 88 SunPower C60 cells with a measured module-level efficiency of $\eta_{sm}=0.20$, an areal density of $k_{sm}=590g/m^2$ and a maximum power output of 275W at $\varphi=45°$ on June 21\textsuperscript{st}. Modules featuring SunPower E60 cells with a measured \cite{Sunier_EPFLSolarModules} $\eta_{sm}=0.23$ are currently being integrated. The solar modules are seamlessly embedded in the upper wing surface to avoid premature flow separation.

\begin{figure}[tb]
    \centering
     \includegraphics[width=\linewidth]{images/8_AtlantikSolar_Avionics}
    \caption{AtlantikSolar system overview. For clarity, voltage lines from the autopilot to connected devices (5.0V and 3.3V) are omitted.}
    \label{fig:AtlantikSolar_SystemOverview}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Actuation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The propulsion system features a foldable custom built carbon-fibre propeller with diameter $D=66cm$ and pitch $H=60cm$. It is driven by a 5:1 reduction-ratio planetary gearbox, a RS-E Strecker 260.20 brushless DC motor with $k_V=450RPM/V$ and a Kontronik Koby 55 LV motor controller at up to $P_{prop,max}=450W$ electrical input power. The actuation system consists of four Volz DA-15N servos that drive the two ailerons, the all-moving elevator and the rudder. To guarantee reliable multi-day flight, the Volz actuators were successfully bench-tested throughout a simulated continuous 30-day flight \cite{DellaCa_BT}.
%mention wind tunnel, lab motor test stand tests? Only if space left...

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Avionics}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The avionics installation (Figs. \ref{fig:AtlantikSolar_SystemOverview} and \ref{fig:CAD_AtlantikSolarStructureAndAvionics}) is centered around a Pixhawk PX4 Autopilot - an open source and open hardware project initiated at ETH Zurich - with a Cortex M4F microprocessor running at 168Mhz and featuring 192kB RAM. For attitude estimation (Sec. \ref{secsec:StateEstimation}), an ADIS 16448 10-axis Inertial Measurement Unit (IMU), a u-Blox LEA-6H GPS receiver, and a Sensirion SDP600 differential pressure sensor are used. The SDP600 airspeed sensor exhibits less than 5\% error at airspeeds of 8m/s, which is essential to closely control the airspeed to the minimum required power $P_{out}$ state. Both a 433Mhz medium-range telemetry link and a long-range IRIDIUM-based satellite backup link are integrated. The airplane implements a fully manual RC-command fall-back mode in case of a severe autopilot failure. Night operations are possible due to four on-board high-power indicator LEDs.

%\begin{figure}[tb]
%    \centering
%    \includegraphics[width=\linewidth]{images/9_CAD_AtlantikSolarAvionics}
%    \caption{Avionics components and their placement inside AtlantikSolar.}
%    \label{fig:9_CAD_AtlantikSolarAvionics}
%\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Payload}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% [THOMAS]
The capabilities of the AtlantikSolar are augmented by a sensor and processing unit which may be mounted beneath the wing. It incorporates a \emph{visual-inertial sensor system} \cite{nikolic2014synchronized} and a small form factor computer based on a Intel Atom processor. The former consists of a processing board, an IMU as well as two cameras - one for thermal imaging using long-wavelength infrared (LWIR) and one for conventional imaging using the visible light - and allows accurate real-time SLAM. The latter is intended for high-level path planning and equipped with WiFi communication to transmit a video feed to the ground.
% + Figure
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{State Estimation and Control Design}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{State Estimation} \label{secsec:StateEstimation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% [AMIR]
  - brief (5 sentence) description of SE type/principle
  - one verification plot (e.g. gps position ``ground truth'' vs. estimated position) 
  then REF to stefan\&Amir paper
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{System Identification} \label{sec:SystemID}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%[DR. ALEXIS]
 - System Identification \& Modelling
 
 \input{chapters/3_DetailedDesign_SystemID}
 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \subsubsection{Control}
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %[PHILIPP writes this, DR. ALEXIS checks this]

\begin{figure}[tb]
    \centering
     \includegraphics[width=\linewidth]{images/11_ControlScheme/ControlScheme}
    \caption{Control Scheme implemented for AtlantikSolar.}
    \label{fig:ControlScheme}
\end{figure}

AtlantikSolar features autonomous navigation including loitering through user-defined waypoints. The whole control structure (Fig. \ref{fig:ControlScheme}) is pre-tuned using the identified system model (Sec. \ref{sec:SystemID}), then functionally tested in an X-Plane 10 Hardware-In-the-Loop (HIL) simulation and finally refined in extensive flight tests. For inner-loop control, our baseline-solution is a set of cascaded PID controllers: The Stability Augmentation System (SAS) applies rate-damping to shape the airplane's frequency response, while the Control Augmentation System (CAS) applies proportional-integral feedback to track roll angle $\phi$ and pitch angle $\theta$. Flight tests show that due to AtlantikSolar's high wingspan and thus high inertia ($I_z$ and $I_x$ especially), coordinated turn control is essential to soften adverse yaw and to achieve the no-sideslip yaw rate $r=\frac{g\cdot \sin(\phi)}{v_{air}}$. To avoid overload of the highly optimized structure, output limiters and an over-speed protection are applied. In addition, Gain-Scheduling with respect to the dynamic pressure $q=\frac{1}{2}\rho v^{2}_{air}$ is employed. Waypoint following is realized through a $\mathcal{L}_1$ non-linear navigation scheme whose detailed integration into our control structure is described in \cite{Oettershagen_MED14_L1MPC}. Altitude and airspeed control are performed by an extended version of the Total Energy Control System (TECS) in the Pixhawk Autopilot\cite{PixhawkWebsite}: First, a slew rate constraint on the reference altitude $h_{ref}$ has been integrated to reach smoother altitude control at pre-definable climb and sink rates, which is especially important for low propulsion-power to weight-ratio UAVs such as AtlantikSolar. Second, we've implemented ``thermal compliance'': In an updraft, the standard TECS implementation will decrease $\theta_{ref}$ to decrease the altitude if $h>h_{ref}$. To allow gaining potential energy from a thermal, we perform gain-scheduling on $k_{SW}$ (the TECS pitch loop ``speed-weight'' parameter), to make TECS use $\theta_{ref}$ fully and only for airspeed control and $u_{Throt}$ only for altitude control. When at $h>h_{ref}$, the plane will thus keep $\theta_{ref}=\theta_{ref}(t)$  such that $v(t)=v_{ref}(t)$ and will gradually disable the motor, potentially gaining altitude for strong thermals. We also implement altitude protections, i.e. full throttle is forced for $h<h_{min}$, at $h>h_{max}$ we re-schedule $k_{SW}$ to gradually allow a pitch-down and thus altitude decrease again, and at $h>h_{max}+50m$ the controller automatically engages the spoilers for maximum descend rate. The inner PID-based pitch- and roll control loops are executed at a sampling period of $T_{SAS,CAS}=0.01s$, while the high-level $\mathcal{L}_1$\&TECS controllers run with $T_{\mathcal{L}_1,TECS}=0.05s$. Given these settings, the full controller requires less than 4\% CPU load, 5KB of RAM and 47KB Flash memory and is thus computationally lightweight when compared to other Pixhawk applications (see \cite{Oettershagen_MED14_L1MPC}) such as the state estimation. The whole control application is designed to be modular, and in addition to the PID-baseline-solution more sophisticated approaches like model-predictive control \cite{Oettershagen_MED14_L1MPC} and failure-tolerant controllers \cite{Mosimann_FT} for inner loop control have been implemented and flown on test planes.
